<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>精读解析器-1.0版本</title>
	<!-- 在<head>中添加PDF生成库 -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
	<!-- 本地样式 -->
	<link rel="stylesheet" href="css/基本样式.css">

	<!-- 代码高亮 -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.css" />
</head>

<body>
	<h1>精读解析器</h1>
	<p>内容格式示范</p>
	<textarea id="jsonInput" style="background-color: black;" placeholder="Paste your JSON here(粘贴你的JSON文本-)">
		{
			"title": "准备睡觉",
			"introduction": "每晚的睡前仪式不仅能帮助我们放松身心，还能提升睡眠质量。本文将带你了解一个温馨的睡前流程，感受其中的舒适与宁静。",
			"paragraphs": [
				{
					"content_en": "Every night, I have a **special** **routine** to get ready for bed. It's like a **cozy** adventure that helps me feel relaxed and ready to sleep.",
					"content_cn": "每天晚上，我都有一个特别的睡前**程序**。这就像一场温馨的冒险，让我感到放松，准备好睡觉。",
					"terms": [
						{
							"word": "special",
							"definition": "adj. 特别的；独特的。",
							"sentence_en": "I have a special routine to get ready for bed.",
							"sentence_cn": "我有一个特别的睡前程序。"
						},
						{
							"word": "routine",
							"definition": "n. 程序；例行公事。",
							"sentence_en": "I have a special routine to get ready for bed.",
							"sentence_cn": "我有一个特别的睡前程序。"
						},
						{
							"word": "cozy",
							"definition": "adj. 舒适的；温馨的。",
							"sentence_en": "It's like a cozy adventure.",
							"sentence_cn": "这就像一场温馨的冒险。"
						}
					]
				},
				{
					"content_en": "When it's time for bed, I start by **putting on** my **pajamas**. I have **a pair of** pajamas with cute animals on them. They are soft and warm, like a **hug**. I feel happy when I wear them because they make me feel safe and cozy.",
					"content_cn": "当到了睡觉时间，我首先穿上我的**睡衣**。我有一套印有可爱动物的睡衣。它们柔软又温暖，就像一个**拥抱**。穿上它们时，我感到快乐，因为它们让我感到安全和舒适。",
					"terms": [
						{
							"word": "putting on",
							"definition": "v. 穿上（put on的现在分词形式）。",
							"sentence_en": "I start by putting on my pajamas.",
							"sentence_cn": "我首先穿上我的睡衣。"
						},
						{
							"word": "pajamas",
							"definition": "n. 睡衣。",
							"sentence_en": "I put on my pajamas.",
							"sentence_cn": "我穿上我的睡衣。"
						},
						{
							"word": "a pair of",
							"definition": "n. 一对；一副。",
							"sentence_en": "I have a pair of pajamas.",
							"sentence_cn": "我有一套睡衣。"
						},
						{
							"word": "hug",
							"definition": "n. 拥抱。",
							"sentence_en": "The pajamas are soft and warm, like a hug.",
							"sentence_cn": "睡衣柔软又温暖，就像一个拥抱。"
						}
					]
				},
				{
					"content_en": "Next, I **brush** my teeth. I use a **toothbrush** with my **favorite** **cartoon** **character** on it. I put a little bit of **toothpaste** on the brush and start brushing. I **make sure** to brush all my teeth, **front** and back, so they stay clean and healthy. The toothpaste tastes **minty** and fresh, like a cool **breeze**.",
					"content_cn": "接下来，我**刷牙**。我用一把印有我最喜欢的**卡通**人物的**牙刷**。我在牙刷上挤一点**牙膏**，然后开始刷牙。我确保刷到每一颗牙齿，前面和后面都要刷，这样牙齿才会保持干净和健康。牙膏的味道**清凉**，就像一阵凉爽的**微风**。",
					"terms": [
						{
							"word": "brush",
							"definition": "v. 刷；刷牙。",
							"sentence_en": "I brush my teeth.",
							"sentence_cn": "我刷牙。"
						},
						{
							"word": "toothbrush",
							"definition": "n. 牙刷。",
							"sentence_en": "I use a toothbrush to brush my teeth.",
							"sentence_cn": "我用牙刷刷牙。"
						},
						{
							"word": "favorite",
							"definition": "adj. 最喜爱的。",
							"sentence_en": "I have a favorite cartoon character.",
							"sentence_cn": "我有一个最喜欢的卡通人物。"
						},
						{
							"word": "cartoon",
							"definition": "n. 卡通；动画片。",
							"sentence_en": "I like watching cartoons.",
							"sentence_cn": "我喜欢看动画片。"
						},
						{
							"word": "character",
							"definition": "n. 人物；角色。",
							"sentence_en": "My toothbrush has a cartoon character on it.",
							"sentence_cn": "我的牙刷上印有卡通人物。"
						},
						{
							"word": "toothpaste",
							"definition": "n. 牙膏。",
							"sentence_en": "I put toothpaste on my toothbrush.",
							"sentence_cn": "我在牙刷上挤牙膏。"
						},
						{
							"word": "make sure",
							"definition": "v. 确保；务必。",
							"sentence_en": "I make sure to brush all my teeth.",
							"sentence_cn": "我确保刷到每一颗牙齿。"
						},
						{
							"word": "front",
							"definition": "n. 前面；adj. 前的。",
							"sentence_en": "I brush the front and back of my teeth.",
							"sentence_cn": "我刷牙齿的前面和后面。"
						},
						{
							"word": "minty",
							"definition": "adj. 薄荷味的；清凉的。",
							"sentence_en": "The toothpaste tastes minty.",
							"sentence_cn": "牙膏的味道清凉。"
						},
						{
							"word": "breeze",
							"definition": "n. 微风；轻风。",
							"sentence_en": "The toothpaste tastes like a cool breeze.",
							"sentence_cn": "牙膏的味道就像一阵凉爽的微风。"
						}
					]
				},
				{
					"content_en": "After brushing my teeth, I go to the bathroom to **wash** my face. I use a soft **washcloth** and some warm water. It feels nice and **refreshing**. Washing my face helps me feel clean and ready for bed.",
					"content_cn": "刷完牙后，我去浴室**洗脸**。我用一块柔软的**洗脸巾**和一些温水。感觉很舒服，也很**清新**。洗脸让我感到干净，准备好睡觉。",
					"terms": [
						{
							"word": "wash",
							"definition": "v. 洗；洗脸。",
							"sentence_en": "I wash my face.",
							"sentence_cn": "我洗脸。"
						},
						{
							"word": "washcloth",
							"definition": "n. 洗脸巾；毛巾。",
							"sentence_en": "I use a washcloth to wash my face.",
							"sentence_cn": "我用洗脸巾洗脸。"
						},
						{
							"word": "refreshing",
							"definition": "adj. 清新的；令人振奋的。",
							"sentence_en": "Washing my face feels refreshing.",
							"sentence_cn": "洗脸感觉很清新。"
						}
					]
				},
				{
					"content_en": "Then, I go to my bedroom. I have a soft, **fluffy** **blanket** on my bed. It feels like a cloud when I **lie down** on it. I also have a **stuffed** animal named Mr. Bear. He is my best friend at night. I **hug** him tight and he makes me feel safe.",
					"content_cn": "然后，我回到我的卧室。我的床上有一条柔软的、**蓬松的** **毯子**。当我**躺下**时，它就像一朵云。我还有一个名叫Mr. Bear的**毛绒**玩具。他是我晚上的好朋友。我紧紧**拥抱**他，他让我感到安全。",
					"terms": [
						{
							"word": "fluffy",
							"definition": "adj. 蓬松的；毛茸茸的。",
							"sentence_en": "I have a fluffy blanket on my bed.",
							"sentence_cn": "我的床上有一条蓬松的毯子。"
						},
						{
							"word": "blanket",
							"definition": "n. 毛毯；毯子。",
							"sentence_en": "I have a soft blanket on my bed.",
							"sentence_cn": "我的床上有一条柔软的毯子。"
						},
						{
							"word": "lie down",
							"definition": "v. 躺下；卧下。",
							"sentence_en": "It feels like a cloud when I lie down on the blanket.",
							"sentence_cn": "当我躺在毯子上时，它就像一朵云。"
						},
						{
							"word": "stuffed",
							"definition": "adj. 充满的；毛绒的。",
							"sentence_en": "I have a stuffed animal named Mr. Bear.",
							"sentence_cn": "我有一个名叫Mr. Bear的毛绒玩具。"
						},
						{
							"word": "hug",
							"definition": "v. 拥抱；抱住。",
							"sentence_en": "I hug Mr. Bear tight.",
							"sentence_cn": "我紧紧拥抱Mr. Bear。"
						}
					]
				},
				{
					"content_en": "Before I **turn off** the light, I like to read a **bedtime** story. My mom or dad sits with me and reads a book. The stories are full of magic and adventure. Sometimes they are about **brave** **knights**, or friendly animals, or **faraway** **lands**. The stories make me feel happy and sleepy.",
					"content_cn": "在我**关灯**之前，我喜欢读一个**睡前**故事。我的妈妈或爸爸会坐在我身边读书。这些故事充满了魔法和冒险。有时它们是关于**勇敢的** **骑士**，或者是友好的动物，或者是**遥远的** **土地**。这些故事让我感到快乐和困倦。",
					"terms": [
						{
							"word": "turn off",
							"definition": "v. 关闭（灯、电器等）。",
							"sentence_en": "I turn off the light before I go to sleep.",
							"sentence_cn": "我睡觉前关灯。"
						},
						{
							"word": "bedtime",
							"definition": "n. 睡觉时间。",
							"sentence_en": "I like to read a bedtime story.",
							"sentence_cn": "我喜欢读睡前故事。"
						},
						{
							"word": "brave",
							"definition": "adj. 勇敢的。",
							"sentence_en": "The stories are about brave knights.",
							"sentence_cn": "这些故事是关于勇敢的骑士的。"
						},
						{
							"word": "knights",
							"definition": "n. 骑士（knight的复数形式）。",
							"sentence_en": "The stories are about brave knights.",
							"sentence_cn": "这些故事是关于勇敢的骑士的。"
						},
						{
							"word": "faraway",
							"definition": "adj. 遥远的。",
							"sentence_en": "The stories are about faraway lands.",
							"sentence_cn": "这些故事是关于遥远的土地的。"
						},
						{
							"word": "lands",
							"definition": "n. 土地；国家（land的复数形式）。",
							"sentence_en": "The stories are about faraway lands.",
							"sentence_cn": "这些故事是关于遥远的土地的。"
						}
					]
				},
				{
					"content_en": "When the story is **over**, I give my **stuffed** animal a goodnight kiss. I say \"goodnight\" to my parents, and they give me a hug and a kiss too. I feel loved and ready to sleep.",
					"content_cn": "当故事**结束**时，我给我的**毛绒**玩具一个晚安吻。我对我的父母说“晚安”，他们也给我一个拥抱和一个吻。我感到被爱，准备好睡觉。",
					"terms": [
						{
							"word": "over",
							"definition": "adj. 结束的；adv. 结束。",
							"sentence_en": "When the story is over, I give my stuffed animal a goodnight kiss.",
							"sentence_cn": "当故事结束时，我给我的毛绒玩具一个晚安吻。"
						}
					]
				},
				{
					"content_en": "As I close my eyes, I think about the fun day I had and the exciting dreams I might have. I feel **peaceful** and cozy in my bed. The room is **dark** and quiet, and I can hear the soft sounds of the night outside my window.",
					"content_cn": "当我闭上眼睛时，我想着我度过的一天和我可能做的激动人心的梦。我在床上感到**平静**和舒适。房间**黑暗**而安静，我可以听到窗外夜晚的微弱声音。",
					"terms": [
						{
							"word": "peaceful",
							"definition": "adj. 平静的；安宁的。",
							"sentence_en": "I feel peaceful and cozy in my bed.",
							"sentence_cn": "我在床上感到平静和舒适。"
						},
						{
							"word": "dark",
							"definition": "adj. 黑暗的；昏暗的。",
							"sentence_en": "The room is dark and quiet.",
							"sentence_cn": "房间黑暗而安静。"
						}
					]
				},
				{
					"content_en": "Getting ready for bed is like a little **ritual** that helps me feel **calm** and ready to rest. It's a special time when I can relax and get ready for a good night's sleep. I love my bedtime routine because it makes me feel happy and safe.",
					"content_cn": "准备睡觉就像一个小**仪式**，帮助我感到**平静**，准备好休息。这是一个特别的时刻，我可以放松并准备好睡个好觉。我喜欢我的睡前程序，因为它让我感到快乐和安全。",
					"terms": [
						{
							"word": "ritual",
							"definition": "n. 仪式；惯例。",
							"sentence_en": "Getting ready for bed is like a little ritual.",
							"sentence_cn": "准备睡觉就像一个小仪式。"
						},
						{
							"word": "calm",
							"definition": "adj. 平静的；镇定的。",
							"sentence_en": "The ritual helps me feel calm and ready to rest.",
							"sentence_cn": "这个仪式帮助我感到平静，准备好休息。"
						}
					]
				}
			]
		}
		</textarea>
	<button onclick="convertJson()">解析</button>
	<button onclick="copyToClipboard()">颗皮</button>
	<button onclick="copyToClipboardDiv()">颗皮html class</button>
	<button onclick="copyToClipboardStyle()">复制style</button>
	<button onclick="clickToPDF()">点击制作PDF</button>
	<button onclick="convertClassToInlineStyleInId('output')">一键转换 class → style</button>

	<section id="output">
		<section class="index">你好</section>
	</section>
	<script src="js/convertJson.js"></script>

	<!-- CodeMirror 样式 & 主题 -->
	<!-- CodeMirror 样式 -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/material.min.css">

	<!-- CodeMirror 核心 & 语言 -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/javascript/javascript.min.js"></script>


	<script>

		CodeMirror.fromTextArea(document.getElementById("jsonInput"), {
			mode: { name: "javascript", json: true },
			lineNumbers: true,
			theme: "material",  // ← 更帅气的黑色风格
			tabSize: 2,
			autoCloseBrackets: true,
		});

	</script>
	<script>
		function clickToPDF() {
			const output = document.getElementById("output");

			// 检查内容有效性
			if (!output.innerHTML.trim() || errMassage) {
				showMessage(errMassage ? "导出失败，存在错误" : "请先解析内容");
				return;
			}

			// 克隆节点并内联样式
			const clonedOutput = output.cloneNode(true);
			inlineStyles(clonedOutput); // 复用已有的样式内联函数

			// 隐藏原始元素显示克隆元素
			const tempContainer = document.createElement('div');
			tempContainer.style.position = 'fixed';
			tempContainer.style.left = '-9999px';
			tempContainer.appendChild(clonedOutput);
			document.body.appendChild(tempContainer);

			// 生成PDF
			html2canvas(clonedOutput, {
				scale: 2, // 提高分辨率
				useCORS: true, // 允许跨域图片
				logging: true // 调试时可开启
			}).then(canvas => {
				const imgData = canvas.toDataURL('image/png');
				const pdf = new jspdf.jsPDF({
					unit: 'mm',
					format: 'a4',
					orientation: 'portrait'
				});

				// 计算图片尺寸
				const pageWidth = pdf.internal.pageSize.getWidth();
				const pageHeight = pdf.internal.pageSize.getHeight();
				const imgRatio = canvas.width / canvas.height;
				let imgWidth = pageWidth;
				let imgHeight = pageWidth / imgRatio;

				// 多页处理
				let position = 0;
				while (position < imgHeight) {
					if (position > 0) pdf.addPage();
					const sliceHeight = Math.min(pageHeight, imgHeight - position);
					pdf.addImage(imgData, 'PNG', 0, -position, imgWidth, imgHeight);
					position += pageHeight;
				}

				// 清理并保存
				document.body.removeChild(tempContainer);
				pdf.save("output.pdf");
				showMessage("PDF已生成");
			}).catch(err => {
				console.error('PDF生成失败:', err);
				showMessage("导出失败，请检查内容");
			});
		}

		// 复用已有的样式内联函数
		function inlineStyles(element) {
			const computedStyle = window.getComputedStyle(element);
			const styleString = Array.from(computedStyle)
				.map(prop => `${prop}: ${computedStyle.getPropertyValue(prop)};`)
				.join(" ");

			if (styleString) {
				element.setAttribute("style", styleString);
			}

			Array.from(element.children).forEach(inlineStyles);
		}
	</script>
</body>

</html>
